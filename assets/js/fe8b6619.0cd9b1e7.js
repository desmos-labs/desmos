"use strict";(self.webpackChunkdesmos_docs=self.webpackChunkdesmos_docs||[]).push([[73375],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,s=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=c(n),h=o,m=d["".concat(l,".").concat(h)]||d[h]||u[h]||s;return n?r.createElement(m,a(a({ref:t},p),{},{components:n})):r.createElement(m,a({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=n.length,a=new Array(s);a[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:o,a[1]=i;for(var c=2;c<s;c++)a[c]=n[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},88727:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>p});n(67294);var r=n(3905);function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o.apply(this,arguments)}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}const a={},i="ADR 019: Subspace post migration",l={unversionedId:"architecture/adr-019-subspace-post-moving",id:"architecture/adr-019-subspace-post-moving",title:"ADR 019: Subspace post migration",description:"Changelog",source:"@site/docs/architecture/adr-019-subspace-post-moving.md",sourceDirName:"architecture",slug:"/architecture/adr-019-subspace-post-moving",permalink:"/architecture/adr-019-subspace-post-moving",draft:!1,editUrl:"https://github.com/desmos-labs/desmos/tree/master/docs/docs/architecture/adr-019-subspace-post-moving.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"ADR 018: Improve subspace treasury account",permalink:"/architecture/adr-018-improve-subspace-treasury-account"},next:{title:"ADR 020: Post ownership transfer",permalink:"/architecture/adr-020-post-ownership-change"}},c={},p=[{value:"Changelog",id:"changelog",level:2},{value:"Status",id:"status",level:2},{value:"Abstract",id:"abstract",level:2},{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"<code>Msg</code> Service",id:"msg-service",level:3},{value:"Hooks",id:"hooks",level:3},{value:"Consequences",id:"consequences",level:2},{value:"Backwards Compatibility",id:"backwards-compatibility",level:3},{value:"Positive",id:"positive",level:3},{value:"Negative",id:"negative",level:3},{value:"Neutral",id:"neutral",level:3},{value:"References",id:"references",level:2}],u={toc:p};function d(e){var{components:t}=e,n=s(e,["components"]);return(0,r.kt)("wrapper",o({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",o({},{id:"adr-019-subspace-post-migration"}),"ADR 019: Subspace post migration"),(0,r.kt)("h2",o({},{id:"changelog"}),"Changelog"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"April 20th, 2023: First draft;"),(0,r.kt)("li",{parentName:"ul"},"April 24th, 2023: First review;"),(0,r.kt)("li",{parentName:"ul"},"May 2th, 2023: Second review;")),(0,r.kt)("h2",o({},{id:"status"}),"Status"),(0,r.kt)("p",null,"Proposed"),(0,r.kt)("h2",o({},{id:"abstract"}),"Abstract"),(0,r.kt)("p",null,"This ADR introduces a new feature that enables post owners to move their own content between subspaces."),(0,r.kt)("h2",o({},{id:"context"}),"Context"),(0,r.kt)("p",null,"Currently, when a user creates a post, they are assigned the author role and become the only user who can edit or manage the post. While this approach works, it may not meet all use cases. For instance, we don't allow users to transfer ownership of a post to another user, which could be useful in certain scenarios. For example, an employee might want to draft a post and later transfer ownership to their company."),(0,r.kt)("h2",o({},{id:"decision"}),"Decision"),(0,r.kt)("p",null,"In order to move the post properly, we will implement an operation that involves the following functions:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"delete all reactions, reports and references that are incompatible with the new subspace of the post"),(0,r.kt)("li",{parentName:"ol"},"reset the moved post ",(0,r.kt)("inlineCode",{parentName:"li"},"PostReferences")," to be ",(0,r.kt)("strong",{parentName:"li"},"empty")),(0,r.kt)("li",{parentName:"ol"},"reset the moved post ",(0,r.kt)("inlineCode",{parentName:"li"},"Conversation")," ID to be ",(0,r.kt)("strong",{parentName:"li"},"0")),(0,r.kt)("li",{parentName:"ol"},"set the proper ",(0,r.kt)("inlineCode",{parentName:"li"},"PostID")," within target subspace")),(0,r.kt)("h3",o({},{id:"msg-service"}),(0,r.kt)("inlineCode",{parentName:"h3"},"Msg")," Service"),(0,r.kt)("p",null,"We will implement a new handler that allows users to move their own posts through a message."),(0,r.kt)("pre",null,(0,r.kt)("code",o({parentName:"pre"},{className:"language-proto"}),"service Msg {\n    // MovePost allows users to move their own posts to another subspace\n    rpc MovePost(MsgMovePost) returns (MsgMovePostResponse);\n}\n\n// MsgMovePost move a post to another subspace\nmessage MsgMovePost {\n    // Id of the subspace where the post is currently located\n    uint64 subspace_id = 1;\n    \n    // Id of the post to be moved\n    uint64 post_id = 2;\n\n    // Id of the target subspace to which the post will be moved\n    uint64 target_subspace_id = 3;\n    \n    // Id of the target section to which the post will be moved\n    uint64 target_section_id = 4;\n\n    // Address of the post owner\n    string owner = 5;\n}\n\n// MsgMovePostResponse defines the Msg/MsgMovePost response type\nmessage MsgMovePostResponse {\n    // New id of the post in the target subspace\n    uint64 post_id = 1;\n}\n")),(0,r.kt)("h3",o({},{id:"hooks"}),"Hooks"),(0,r.kt)("p",null,"Currently, reactions and report reasons are not compatible across different subspaces. This means that the IDs used to identify reactions and reasons may differ between subspaces. To address this limitation, we propose implementing a hook to notify ",(0,r.kt)("inlineCode",{parentName:"p"},"x/reactions"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"x/reports")," and other references modules, which will be used to remove references to the posts. The hook will be as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",o({parentName:"pre"},{className:"language-go"}),"func (k Keeper) AfterPostMoved(ctx sdk.Context, subspaceID uint64, postID uint64) {\n    // Remove all reactions, reports and other references to the post\n}\n")),(0,r.kt)("h2",o({},{id:"consequences"}),"Consequences"),(0,r.kt)("h3",o({},{id:"backwards-compatibility"}),"Backwards Compatibility"),(0,r.kt)("p",null,"As the only major change will be to introduce a new message handler, this change is completely backward compatible."),(0,r.kt)("h3",o({},{id:"positive"}),"Positive"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Enable users to move their own posts easily.")),(0,r.kt)("h3",o({},{id:"negative"}),"Negative"),(0,r.kt)("p",null,"(none known)"),(0,r.kt)("h3",o({},{id:"neutral"}),"Neutral"),(0,r.kt)("p",null,"(none known)"),(0,r.kt)("h2",o({},{id:"references"}),"References"))}d.isMDXComponent=!0}}]);