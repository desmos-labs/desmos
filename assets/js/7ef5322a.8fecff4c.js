"use strict";(self.webpackChunkdesmos_docs=self.webpackChunkdesmos_docs||[]).push([[19502],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>h});var a=r(67294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)r=s[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)r=s[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var o=a.createContext({}),d=function(e){var t=a.useContext(o),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},c=function(e){var t=d(e.components);return a.createElement(o.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,s=e.originalType,o=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=d(r),h=n,f=p["".concat(o,".").concat(h)]||p[h]||u[h]||s;return r?a.createElement(f,l(l({ref:t},c),{},{components:r})):a.createElement(f,l({ref:t},c))}));function h(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var s=r.length,l=new Array(s);l[0]=p;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i.mdxType="string"==typeof e?e:n,l[1]=i;for(var d=2;d<s;d++)l[d]=r[d];return a.createElement.apply(null,l)}return a.createElement.apply(null,r)}p.displayName="MDXCreateElement"},95022:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>p,frontMatter:()=>l,metadata:()=>o,toc:()=>c});r(67294);var a=r(3905);function n(){return n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},n.apply(this,arguments)}function s(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)r=s[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)r=s[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}const l={},i="ADR 013: Per-chain default external address",o={unversionedId:"architecture/adr-013-per-chain-default-address",id:"architecture/adr-013-per-chain-default-address",title:"ADR 013: Per-chain default external address",description:"Changelog",source:"@site/docs/architecture/adr-013-per-chain-default-address.md",sourceDirName:"architecture",slug:"/architecture/adr-013-per-chain-default-address",permalink:"/architecture/adr-013-per-chain-default-address",draft:!1,editUrl:"https://github.com/desmos-labs/desmos/tree/master/docs/docs/architecture/adr-013-per-chain-default-address.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"ADR 012: Subspaces sections",permalink:"/architecture/adr-012-subspaces-sections"},next:{title:"ADR 014: Improve the permission system",permalink:"/architecture/adr-014-improve-permissions"}},d={},c=[{value:"Changelog",id:"changelog",level:2},{value:"Status",id:"status",level:2},{value:"Abstract",id:"abstract",level:2},{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"Store",id:"store",level:3},{value:"<code>Msg</code> Service",id:"msg-service",level:3},{value:"<code>Query</code> Service",id:"query-service",level:3},{value:"Consequences",id:"consequences",level:2},{value:"Backwards Compatibility",id:"backwards-compatibility",level:3},{value:"Positive",id:"positive",level:3},{value:"Negative",id:"negative",level:3},{value:"Neutral",id:"neutral",level:3},{value:"References",id:"references",level:2}],u={toc:c};function p(e){var{components:t}=e,r=s(e,["components"]);return(0,a.kt)("wrapper",n({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",n({},{id:"adr-013-per-chain-default-external-address"}),"ADR 013: Per-chain default external address"),(0,a.kt)("h2",n({},{id:"changelog"}),"Changelog"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"May 18th, 2022: Initial draft;")),(0,a.kt)("h2",n({},{id:"status"}),"Status"),(0,a.kt)("p",null,"ACCEPTED Implemented"),(0,a.kt)("h2",n({},{id:"abstract"}),"Abstract"),(0,a.kt)("p",null,"This ADR contains the specification of ",(0,a.kt)("em",{parentName:"p"},"per-chain default external addresses"),", a new feature that will allow users to specify which external address should be used as the default one for each external chain they have linked to their Desmos profile."),(0,a.kt)("h2",n({},{id:"context"}),"Context"),(0,a.kt)("p",null,"Currently, Desmos allows users to link external chain accounts to their profile by specifying a chain name and an external address associated to such chain. For each chain, each user can link multiple external addresses to the same profile. Although this allows for greater extensibility and usability, there are some occasions in which it might make it harder to properly use this feature. For example, one application might want to deal with a single external address per chain. Right now this is not easy to do as there are many ways in which that single chain link can be chosen among multiple ones (e.g. the first created, or the last one). "),(0,a.kt)("h2",n({},{id:"decision"}),"Decision"),(0,a.kt)("p",null,"We will allow users to specify a ",(0,a.kt)("em",{parentName:"p"},"default address")," for each external chain they have connected to their Desmos profile. Initially, when creating an external chain link, the first link will be set as the default one. Later, each user will be able to set a specific link as the default one to be used when dealing with a specific chain."),(0,a.kt)("h3",n({},{id:"store"}),"Store"),(0,a.kt)("p",null,"Each default chain link will be stored inside the state using the following key:"),(0,a.kt)("pre",null,(0,a.kt)("code",n({parentName:"pre"},{}),"DefaultChainLinkPrefix | UserAddress | ChainName | -> ExternalAddress \n")),(0,a.kt)("p",null,"This will allow to easily get a default external address based on the user address and chain name, which is going to be the most used query. It will also allow to easily iterate over all default external addresses for each user. "),(0,a.kt)("h3",n({},{id:"msg-service"}),(0,a.kt)("inlineCode",{parentName:"h3"},"Msg")," Service"),(0,a.kt)("p",null,"In order to allow each user to set their own custom default external addresses, we will need to implement a new message. "),(0,a.kt)("pre",null,(0,a.kt)("code",n({parentName:"pre"},{className:"language-protobuf"}),'syntax = "proto3";\n\n// Msg defines the profiles Msg service.\nservice Msg {\n  // SetDefaultExternalAddress allows to set a specific external address as the default one for a given chain\n  rpc SetDefaultExternalAddress(MsgSetDefaultExternalAddress) returns (MsgSetDefaultExternalAddressResponse);\n}\n\n// MsgSetDefaultExternalAddress represents the message used to set a default address for a specific chain\nmessage MsgSetDefaultExternalAddress {\n  // Name of the chain for which to set the default address\n  string chain_name = 1;\n  \n  // Address to be set as the default one\n  string target = 2;\n  \n  // User signing the message\n  string signer = 3;\n}\n\n// MsgSetDefaultExternalAddressResponse represents the Msg/SetDefaultExternalAddress response type\nmessage MsgSetDefaultExternalAddressResponse {}\n')),(0,a.kt)("h3",n({},{id:"query-service"}),(0,a.kt)("inlineCode",{parentName:"h3"},"Query")," Service"),(0,a.kt)("p",null,"In order to allow clients to easily query for default chain links, we will implement a new query."),(0,a.kt)("pre",null,(0,a.kt)("code",n({parentName:"pre"},{className:"language-protobuf"}),'syntax = "proto3";\n\n// Query defines the gRPC querier service\nservice Query {\n  //  DefaultExternalAddresses queries the default addresses associated to the given user and (optionally) chain name\n  rpc DefaultExternalAddresses(QueryDefaultExternalAddressesRequest) returns (QueryDefaultExternalAddressesResponse) {\n    option (google.api.http).get = "/desmos/profiles/v2/default-addresses";\n  }\n}\n\n// QueryDefaultExternalAddressesRequest is the request type for Query/DefaultExternalAddresses RPC method\nmessage QueryDefaultExternalAddressesRequest {\n  // User for which to query the default addresses\n  string user = 1;\n  \n  // (optional) Chain name to query the default address for\n  string chain_name = 2;\n  \n  // pagination defines an optional pagination for the request.\n  cosmos.base.query.v1beta1.PageRequest pagination = 3;\n}\n\n// QueryDefaultExternalAddressesResponse is the response type for Query/DefaultExternalAddresses RPC method\nmessage QueryDefaultExternalAddressesResponse {\n  // List of default addresses, each one represented by the associated chain link \n  repeated ChainLink chain_links = 1 [ (gogoproto.nullable) = false ];\n  \n  cosmos.base.query.v1beta1.PageResponse pagination = 2;\n}\n')),(0,a.kt)("h2",n({},{id:"consequences"}),"Consequences"),(0,a.kt)("h3",n({},{id:"backwards-compatibility"}),"Backwards Compatibility"),(0,a.kt)("p",null,"As the only major change will be to introduce a new set of store keys, this change is completely backward compatible."),(0,a.kt)("h3",n({},{id:"positive"}),"Positive"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Allow to get a user's default external addresses, allowing for more use cases to be implemented")),(0,a.kt)("h3",n({},{id:"negative"}),"Negative"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Increase storage space by introducing a new set of keys")),(0,a.kt)("h3",n({},{id:"neutral"}),"Neutral"),(0,a.kt)("p",null,"{neutral consequences}"),(0,a.kt)("h2",n({},{id:"references"}),"References"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Issue ",(0,a.kt)("a",n({parentName:"li"},{href:"https://github.com/desmos-labs/desmos/issues/853"}),"#853"),".")))}p.isMDXComponent=!0}}]);