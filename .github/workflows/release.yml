name: Release
# Release workflow builds the binaries for a release, and then publishes them to a newly created GitHub release.

on:
  # TODO: Remove this
  pull_request:
  release:
    types: [ created ]

jobs:
  generate:
    name: Create release binaries
    runs-on: ubuntu-18.04
    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v2

      - name: Setup Go 🧰
        uses: actions/setup-go@v2.1.3
        with:
          go-version: 1.15

      - name: Build the artifacts 🏭
        env:
          LEDGER_ENABLED: true
        run: |
          make build-reproducible

      - name: Upload the artifacts 📤
        uses: actions/upload-artifact@v2
        with:
          name: 'darwin/amd64'
          path: 'artifacts/*darwin*amd64*'

      - name: Upload the artifacts 📤
        uses: actions/upload-artifact@v2
        with:
          name: 'linux/amd64'
          path: 'artifacts/*linux*amd64*'

      - name: Upload the artifacts 📤
        uses: actions/upload-artifact@v2
        with:
          name: 'darwin/arm64'
          path: 'artifacts/*linux*arm64*'

      - name: Upload the artifacts 📤
        uses: actions/upload-artifact@v2
        with:
          name: 'windows/amd64'
          path: 'artifacts/*windows*amd64*'

#      - name: Release the artifacts 📤
#        uses: skx/github-action-publish-binaries@master
#        env:
#          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#        with:
#          args: 'artifacts/desmos-*'